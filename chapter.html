
{% extends "base.html" %}
{% block title %}Chapter {{ chapter.order }}{% endblock %}
{% block content %}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h1 class="h5 mb-0">#{{ chapter.order }} — {{ chapter.title or 'Untitled' }}</h1>
  <div class="d-flex gap-2">
    <button class="btn btn-sm btn-outline-light" onclick="translateChapter('English')">Translate → English</button>
    <button class="btn btn-sm btn-outline-light" onclick="translateChapter('Filipino')">Translate → Filipino</button>
  </div>
</div>
<div class="row g-3">
  <div class="col-md-6">
    <div class="card bg-secondary text-light">
      <div class="card-header">Source</div>
      <div class="card-body"><pre style="white-space: pre-wrap;">{{ chapter.source_text }}</pre></div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="card bg-secondary text-light">
      <div class="card-header">Translated</div>
      <div class="card-body" id="translated"><pre style="white-space: pre-wrap;">{{ chapter.translated_text or '—' }}</pre></div>
    </div>
  </div>
</div>
<script>
async function translateChapter(target){
  const r = await fetch("{{ url_for('translate_chapter', novel_id=chapter.novel_id, order=chapter.order) }}", {
    method: "POST",
    headers: {"Content-Type":"application/json"},
    body: JSON.stringify({ target_language: target })
  });
  const j = await r.json();
  if(j.success){
    location.reload();
  }else{
    alert(j.error || "Translation failed");
  }
}
</script>
{% endblock %}
